{% extends "base.html" %}
{% load static %}

{% block content %}

<div style="background-color: #262626">
    <div class="container special-container">
       <p style="color:white; font-size: 40px; font-weight: bold">PU Palette</p>
       <div style="width: 75%">
           <p style="color:#BDBDBD; font-size: 12px; font-weight: 300">Click into an image to view more information about the artwork on the Princeon University Art Museum website.</p>
        </div>
    </div>

       <div class = "container">
        <div class="row" style="padding-bottom:20px">
            <!-- Titles -->
            <div class = "column" style="flex:55%">
                <p id="country" class = "inputlabel">Country, Date</p>
                <p id="date" class = "inputlabel">Date</p>
                 <!--Go Back button FIX FUNCTIONALITY -->
                 <div style="padding-top:10px">
                     <button class="inputbox" style="color:white" onclick="goBack()">< Back to Map</button>
                 </div>
            </div>

            <!-- space between -->
            <div class = "column" style="flex:25%"> </div>

            <!-- color circle -->
            <div class = "column" style="flex:20%">
                <div id = "color" class = "no-click-circle"></div>
            </div>

        </div>
</div>


    
    <div class = "loader" id="loader" style="display: none;"></div>

</div>


    <div class="container special-container">
        <div id="imageContainer" class="image-grid inputlabel"></div>
    </div>



        <script>
            function goBack() {
                window.history.back();
            }

            // https://stackoverflow.com/questions/29488371/how-to-add-a-list-of-images-to-the-document-from-an-array-of-urls
            // imgs is an array of image urls. modify so imgs is filled with urls from database.

        var queryString = decodeURIComponent(window.location.search);
        queryString = queryString.substring(1);
        var queries = queryString.split("&");
        let rangeStr = queries[0];
        let rgbStr = queries[1];
        let mapidsStr = queries[2];


        let country = mapidsStr.replace(/_/g, " ")
        let date = getDate(rangeStr)
        let color = "rgb("+ rgbStr+ ")"

            
        document.getElementById("country").innerHTML = country;
        document.getElementById("date").innerHTML = date;
        document.getElementById("color").style.backgroundColor =color;


        function getDate(dateStr) {
            let date = ""

            if (dateStr=="-15000,-2001") date = "15000 - 2001 BC";
            else if (dateStr=="-2000,-1001") date = "2000 - 1001 BC";
            else if (dateStr=="-1000,0") date = "1000 BC - 0 AD";
            else if (dateStr=="1,499") date = "1 - 499 AD";
            else if (dateStr=="500,999") date = "400 - 999 AD";
            else if (dateStr=="1000,1499") date = "1000 - 1499";
            else if (dateStr=="1500,1599") date = "1500 - 1599";
            else if (dateStr=="1600,1699") date = "1600 - 1699";
            else if (dateStr=="1700,1799") date = "1700 - 1799";
            else if (dateStr=="1800,1849") date = "1800 - 1849";
            else if (dateStr=="1850,1899") date = "1850 - 1899";
            else if (dateStr=="1900,1944") date = "1900 - 1944";
            else if (dateStr=="1945,2021") date = "1945 - Present";

            return date
        }

                // Function to color the map accordingly 
        function searchFunc(rangeStr, rgbStr, mapidsStr, callback){
            // let rangeStr = "1800,1849" // get the range from url 
            // let rgbStr = "184,106,50" // get the rgbstr from url 
            // let mapidsStr = "United_States" // get mapid from url 
            $.ajax({
              type: "GET",
              url: "/colorSearch/",  // figure out how to link to colorSearch.py!!
              data: { 
                csrfmiddlewaretoken: '{{ csrf_token }}',
                searchRGB: rgbStr,
                dateRange: rangeStr,
                mapIDs: mapidsStr},
              beforeSend: function(){
                $("#loader").show();
              },
              success: callback,
              complete: function(data) {
                $("#loader").hide();
              }
            });
        } 

        function getImages() {
            searchFunc(rangeStr, rgbStr, mapidsStr, function(response){
                count = response[0];
                objectIDs = response[1];
                imgURLs = response[2];

                if (count == 0) {
                    document.getElementById('imageContainer').innerHTML= "No Results"
                    return
                }


                var container = document.getElementById('imageContainer');

                for (let i = 0; i < count; i++) {
                    var img = document.createElement('img');
                    img.src = imgURLs[0][i];
                    img.style = "width:auto; height:180px; padding:10px; display: inline-block"

                    var link = document.createElement('a');
                    var baseURL = "https://artmuseum.princeton.edu/collections/objects/"
                    objectID = objectIDs[0][i]

                    link.setAttribute("href", baseURL+objectID);
                    link.setAttribute("target", "_blank");
                    link.appendChild(img)

                    container.appendChild(link);
                }
            });
            
        }

        getImages()
        

        </script>

 


{% endblock %}
