{% extends "base.html" %}
{% load static %}

{% block content %}


<div style="background-color: #262626">
	<div class="container special-container">
	   <p style="color:white; font-size: 40px; font-weight: bold">PU Palette</p>
		 <div style="width: 75%">
		   <p style="color:#BDBDBD; font-size: 12px; font-weight: 300">The goal of our project is to create a new interactive and visually interesting medium for consuming the Princeton University Art Museum’s online database, by representing how color has been used in different regions over time. Include description of the website and how to use it (Ezra Zinberg and Nina He). </p>
		</div>
	</div>

	<div class = "container">
		<div class="row" style="padding-bottom:20px">
			<!-- date slider -->
			<div class = "column" style="flex:60%">
				<p class = "inputlabel">Date</p>
				<input class = "inputbox" id="sliderInput"></input>
				<div class="slidecontainer">
		 			<input type="range" min="0" max="12" value="8" class="slider" id="slider">
				</div>
			</div>

			<!-- space between -->
			<div class = "column" style="flex:5%"> </div>

			<!-- color + hex -->
			<div class = "column" style="flex:10%">
				<p class = "inputlabel">Color </p>
				<input class = "inputbox" id="hexval" value="#ff0000"></input>
				
			</div>

			<!-- space between -->
			<div class = "column" style="flex:5%"> </div>

			<!-- color circle -->
			<div class = "column" style="flex:20%">
				<div id = "circle" class = "circle" onclick="showPicker()"></div>
				<div class="ColorPicker" id="boxPicker" style="display:none; position: absolute; padding-top: 10px; ">
		        </div>

			</div>

		</div>
	</div>
</div>



<div class = "container special-container">
 	<object data = "{% static 'worldmap.svg'%}" id="alphasvg" type = "image/svg+xml" width = "100%" ></object>
</div>

	<script>

// ESSENTIAL VARIABLES & FUNCTIONS//
	// Country IDs ** missing some countries in the svg map (refer to google doc) 
		let ids = ["Canada", "Mexico", "Peru", "Ecuador", "Ethiopia", "Japan", "China", "Netherlands", "United_States", "Austria", "Italy", "UK", "Egypt", "Indonesia", "Belgium", "Syria", "Israel", "Côte d’Ivoire", "Lebanon", "France", "Germany", "Spain", "Australia", "Greece", "Colombia", "Switzerland", "Denmark", "Sri_Lanka", "Thailand", "Cambodia", "Panama", "Algeria", "Guatemala", "Turkey", "Nigeria", "Portugal", "Ireland", "Norway", "Congo", "India", "Afghanistan", "Iran", "Sweden", "Kenya", "Vietnam", "Ukraine", "Brazil", "Nicaragua", "Cyprus", "Iraq", "Russia", "Bolivia", "Tunisia", "Costa_Rica", "Argentina", "Chile", "Angola", "jordan", "nepal", "pakistan", "ghana", "gabon", "st._lucia", "el_salvador", "papua_new_guinea", "guinea", "grenada", "romania", "hungary", "New_Caledonia", "Tanzania", "South_Korea", "Madagascar", "Zimbabwe", "Centrafrique", "Domincan_Republic", "Rwanda", "South_Africa", "Fiji", "Uruguay", "Sierra_Leone", "Venezuela", "Morocco", "Benin", "Poland"]

		let mini_ids = ["Canada", "Mexico", "Peru", "Ecuador", "Ethiopia", "Japan", "China", "Netherlands", "United_States", "Austria", "Italy", "UK", "Egypt"]


		var slider = document.getElementById("slider");
		var sliderInput = document.getElementById("sliderInput");
		var hexval = document.getElementById("hexval");
		var circle = document.getElementById("circle");


		let colorVAR = null;
		let color = null;
		let most = null;
		let few = '#696969'
		let none = '#333333'

		sliderInput.value = "1700-1800";
		circle.style.backgroundColor = "#262626";



	// Function determining color based on frequency of artworks
		function getColor(value) {
			if (value > 3) {
				color = most
			}
			else if (value > 0 && value <= 3){
				color = few
			}
			else if (value == 0){
				color = none
			}
			return color
		}

	// Get range of dates in string form (for colorMap function)
		function getRange(val) {
			range = [];
			low = "";
			high = "";

			if (val == 0){low = "-15000"; high ="-2000"}
			else if (val == 1) {low ="-2000"; high = "-1000"}
			else if (val == 2) {low = "-1000"; high ="1"}
			else if (val == 3) {low = "1"; high ="500"}
			else if (val == 4) {low = "500"; high = "1000"}
			else if (val == 5) {low = "1000"; high = "1500"}
			else if (val == 6) {low = "1500"; high = "1600"}
			else if (val == 7) {low = "1600"; high = "1700"}
			else if (val == 8) {low = "1700"; high = "1800"}
			else if (val == 9) {low = "1800"; high = "1850"}
			else if (val == 10) {low = "1850"; high = "1900"}
			else if (val == 11) {low = "1900"; high = "1945"}
			else if (val == 12) {low = "1945"; high = "2020"}

			range.push(low);
			range.push(high);

			return range
		}


	// Function to color the map accordingly 
		function colorMap(svgDoc){
			// color the map
			for (i = 0; i < mini_ids.length; i++) {
				let inc = i
				let count = 0;
				let objectIDs = []; // empty list for object ids 
				let range = getRange(slider.value);
				let country = mini_ids[inc].replace("_", " ");
				let values = country + "/" + range[0] + "/" + range[1]
				let rgbStr = circle.style.backgroundColor.match(/\d+/g); 
				let rgb = rgbStr[0] + "/" + rgbStr[1] + "/" + rgbStr[2]

				
				$.ajax({
				  type: "GET",
				  url: "/colorSearch/",  // figure out how to link to colorSearch.py!!
				  data: { 
				  	csrfmiddlewaretoken: '{{ csrf_token }}',
				  	searchRGB: rgb,
				  	vals: values},
				  success: function(response) {
				  	count = response[0]
				  	objectIDs = response[1]
				  	colorVAR = getColor(count)
				  	svgDoc.getElementById(mini_ids[inc]).style.fill = colorVAR;
				  }
				});
			}
		} 

// COLOR PICKER //
	// Toggles showing color picker on click of circle
		function showPicker() {
		  var x = document.getElementById("boxPicker");
		  if (x.style.display === "none") {
		    x.style.display = "block";
		  } else {
		    x.style.display = "none";
		  }
		}

	// Box & hue slider from iro.js 
		var boxPicker = new iro.ColorPicker("#boxPicker", {
		  width: 125,
		  color: "rgb(255, 0, 0)",
		  borderWidth: 0,
		  borderColor: "#262626",
		  layout: [
		    {
		      component: iro.ui.Box,
		    },
		    {
		      component: iro.ui.Slider,
		      options: {
		        sliderType: 'hue'
		      }
		    }
		  ]
		});


// ONCHANGE EVENTS

		var a = document.getElementById("alphasvg");
	    a.addEventListener("load",function(){
	       // get the inner DOM of alpha.svg
            var svgDoc = a.contentDocument;

			// Fills circle and adjust box/hue slider colors & position with hex input
			hexval.onchange = function() {
				circle.style.backgroundColor = this.value;
				boxPicker.addColor(this.value);
				boxPicker.removeColor(0);
			}
	
			boxPicker.on(["color:init", "color:change"], function(color){
			  hexval.value = color.hexString;
			  circle.style.backgroundColor = color.hexString;
			  most = hexval.value;
			  colorMap(svgDoc)
			});

			// changing the slider input based on slider location
		    slider.oninput = function () {
		       	val = this.value
		       	if (val == 0){date = "15000-2000 BC"}
				else if (val == 1) {date = "2000-1000 BC"}
				else if (val == 2) {date = "1000 BC - 1 AD"}
				else if (val == 3) {date = "1-500 AD"}
				else if (val == 4) {date = "500-1000"}
				else if (val == 5) {date = "1000-1500"}
				else if (val == 6) {date = "1500-1600"}
				else if (val == 7) {date = "1600-1700"}
				else if (val == 8) {date = "1700-1800"}
				else if (val == 9) {date = "1800-1850"}
				else if (val == 10) {date = "1850-1900"}
				else if (val == 11) {date = "1900-1945"}
				else if (val == 12) {date = "1945-Present"}
				sliderInput.value = date;
		    	colorMap(svgDoc)
			}

		    // changing the slider location based on input
			sliderInput.onchange = function () {
				val = this.value;
				if (val <= -2000){date = "15000-2000 BC"; slider.value = 0;}
				else if (val > -2000 && val <=-1000) {date = "2000-1000 BC"; slider.value = 1;}
				else if (val > -1000 && val <=1) {date = "1000 BC - 1 AD"; slider.value = 2;}
				else if (val > 1 && val <=500) {date = "1-500 AD"; slider.value = 3;}
				else if (val > 500 && val <= 1000){date = "500-1000"; slider.value = 4;}
				else if (val > 1000 && val <=1500) {date = "1000-1500"; slider.value = 5;}
				else if (val > 1500 && val <=1600) {date = "1500-1600"; slider.value = 6;}
				else if (val > 1600 && val <=1700) {date = "1600-1700"; slider.value = 7;}
				else if (val > 1700 && val <=1800) {date = "1700-1800"; slider.value = 8;}
				else if (val > 1800 && val <= 1850){date = "1800-1850"; slider.value = 9;}
				else if (val > 1850 && val <=1900) {date = "1850-1900"; slider.value = 10;}
				else if (val > 1900 && val <=1945) {date = "1900-1945"; slider.value = 11;}
				else if (val > 1945) {date = "1945-Present"; slider.value = 12;}
				sliderInput.value = date;
				colorMap(svgDoc)
			}

	    }, false);
	   

		
	</script>
{% endblock %}

